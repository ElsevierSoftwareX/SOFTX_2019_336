

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. Network Preparation &mdash; sDNA Open 4.0.2 documentation</title>
    
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '4.0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="top" title="sDNA Open 4.0.2 documentation" href="index.html" />
    <link rel="next" title="3. Analysis: what the results mean" href="analysis-friendly.html" />
    <link rel="prev" title="1. Introduction" href="introduction.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="analysis-friendly.html" title="3. Analysis: what the results mean"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="introduction.html" title="1. Introduction"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">sDNA Open 4.0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/weblogo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">2. Network Preparation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#principles">2.1. Principles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-in-a-misleading-format">Data in a misleading format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#connectivity-rules">Connectivity rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spatial-reference">Spatial reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#connectivity-errors-at-key-locations">Connectivity errors at key locations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cluster-tolerance">Cluster tolerance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#intersections-and-overlaps">Intersections and overlaps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#incorrect-grade-separation-elevation-and-oneway-data">Incorrect grade separation, elevation and oneway data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#definitive-check-for-connectivity-errors">Definitive check for connectivity errors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#geometry-errors-at-key-locations">Geometry errors at key locations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#traffic-islands">Traffic islands</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tools">2.2. Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#break-intersections">Break intersections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#topology">Topology</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#notes-on-specific-formats">2.3. Notes on specific formats</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#address-point-data">Address point data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#openstreetmap-osm">OpenStreetMap (OSM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pedestrian-networks">Pedestrian networks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="analysis-friendly.html">3. Analysis: what the results mean</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis-spec.html">4. Analysis: full specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">5. Troubleshooting Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation_usage.html">6. Installation and first usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_to_individual_tools.html">7. Guide to individual tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="step_by_step_guides.html">8. Step by step guides for specific tasks</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction.html"
                        title="previous chapter">1. Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="analysis-friendly.html"
                        title="next chapter">3. Analysis: what the results mean</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="network-preparation">
<span id="id1"></span><h1>2. Network Preparation<a class="headerlink" href="#network-preparation" title="Permalink to this headline">¶</a></h1>
<p>The phrase “garbage in, garbage out” applies to spatial network analysis
just as much as it applies to all modelling.  Careful preparation of spatial networks for analysis is essential to getting a meaningful result.</p>
<p>This chapter is a much needed guide to the pitfalls we have found in
preparing data for spatial network analysis. Hopefully by following it
you can avoid the mistakes we used to make, and have seen others make.
Although this guide now forms part of the sDNA manual, it applies equally well to any other form of spatial network
analysis.</p>
<p>We present the material as follows</p>
<ul class="simple">
<li><a class="reference internal" href="#principles"><span>Principles</span></a> discusses the types of errors that appear in spatial networks and how, in theory, to correct them</li>
<li><a class="reference internal" href="#tools"><span>Tools</span></a> discusses specific tools that can be used to achieve this correction, depending on your working environment</li>
<li><a class="reference internal" href="#notes-on-specific-formats"><span>Notes on specific formats</span></a> contains notes on preparing some commonly used network formats</li>
</ul>
<div class="section" id="principles">
<span id="id2"></span><h2>2.1. Principles<a class="headerlink" href="#principles" title="Permalink to this headline">¶</a></h2>
<p>The relationship between data quality, and analysis quality, is not linear.  A single error in a critical place could invalidate an entire analysis; meanwhile, numerous errors in non-critical places can have negligible effect.</p>
<p>Three classes of error should be treated as a matter of priority in spatial network analysis:</p>
<ul class="simple">
<li><a class="reference internal" href="#data-in-a-misleading-format"><span>Data in a misleading format</span></a></li>
<li><a class="reference internal" href="#connectivity-errors-at-key-locations"><span>Connectivity errors at key locations</span></a></li>
<li><a class="reference internal" href="#geometry-errors-at-key-locations"><span>Geometry errors at key locations</span></a></li>
</ul>
<div class="section" id="data-in-a-misleading-format">
<span id="id3"></span><h3>Data in a misleading format<a class="headerlink" href="#data-in-a-misleading-format" title="Permalink to this headline">¶</a></h3>
<div class="section" id="connectivity-rules">
<span id="id4"></span><h4>Connectivity rules<a class="headerlink" href="#connectivity-rules" title="Permalink to this headline">¶</a></h4>
<p>It’s easy to assume, just because the software appears to successfully
load your data, that the data was in the right format; indeed it is easy to presume that if the format was
wrong, the data would have failed to load.  With spatial network data this is often not the case.</p>
<p>Software will certainly complain if it doesn’t recognise a given GIS and
CAD file format (like a shapefile, geodatabase or DWG). But each of
these formats are restricted to describing two things, <em>shapes</em> and
<em>data</em>. What they don’t describe is the <em>meaning</em> of those shapes and
data. For example, a shape file could contain two lines which cross like
this (blobs are used to make it clear where lines start and end):</p>
<div class="figure" id="id15">
<span id="crossinglines"></span><img alt="_images/prep1.PNG" src="_images/prep1.PNG" />
<p class="caption"><span class="caption-text">Figure 4: Two lines in a shapefile, but what do they mean?</span></p>
</div>
<p>As it stands, that’s just two intersecting lines. But suppose you knew that the lines represent a street network. Now they have a
<em>meaning</em> - but the meaning isn’t quite clear yet. Are we looking at a
crossroads, where two streets join, or a bridge, where one is crossing
over another? To answer that question, we need to specify a
<em>connectivity rule</em> for the data.</p>
<p>sDNA processes spatial networks encoded using a <strong>coincident endpoint
connectivity rule.</strong> This is a common standard used in many data sets
e.g. OpenStreetMap and Ordnance Survey products as well as other
software such as ArcGIS Network Analyst.
(Provided you take grade separation into account. Ordnance survey
specify grade separations for each end of a link, and links only join
if their grade separations match).</p>
<blockquote>
<div><p>The <strong>coincident endpoint connectivity rule</strong></p>
<ol class="arabic simple">
<li>A network is formed by a collection (feature set) of polylines</li>
<li>Lines are deemed to be connected if and only if they have coincident endpoints (the lines must end on exactly the same point).</li>
</ol>
</div></blockquote>
<p>So, as far as sDNA is concerned, the two lines in <a href="#crossinglines">Figure  4</a> don’t
connect, because they have different endpoints. They simply intersect
one another, and could either represent a bridge or a tunnel.  This category is so common that it has its own name,
a <em>brunnel</em> (or, in honour of the Victorian engineer, a <em>brunel</em>).  These features are also called <em>unlinks</em>, because the lines represent objects which are not linked.</p>
<p><a href="#crossinglines">Figure  4</a> does not, however, represent a crossroads – and a crossroads is
usually what the designer intended. This is a serious data error.  The representation of a
crossroads, using coincident endpoint connectivity, requires four
separate lines:</p>
<div class="figure" id="id16">
<span id="crossinglinesnoded"></span><img alt="_images/prep2.PNG" src="_images/prep2.PNG" />
<p class="caption"><span class="caption-text">Figure 5: Four lines in a shapefile, representing a crossroads according to
<em>coincident endpoint connectivity rules</em></span></p>
</div>
<p>If the junctions in your network are formatted like <a href="#crossinglines">Figure  4</a>, not <a href="#crossinglinesnoded">Figure  5</a>,
then all network analysis done by software expecting coincident
endpoints will be completely meaningless. This cannot be emphasized
enough – it may seem obvious, but I have often seen this mistake made in
practice, because (unless the software is set to display blobs on the
ends of lines, as I have in this document) the two formats both load correctly and look identical to the viewer.</p>
<p>Another reason this mistake is often made is that drawing networks using
a coincident endpoint connectivity rule is tedious, time-consuming,
painful and error-prone. The designer has to draw a lot more lines than
they would otherwise need to, and those lines don’t really seem to match
up with the way we (as humans) think about space. For these reasons,
people don’t like to draw networks with coincident endpoint
connectivity. This is absolutely fine – avoiding a tedious and
error-prone task is to be encouraged. But it is vital that the networks
thus produced are converted to coincident endpoint connectivity before
analysis.</p>
<p>Of course, if you draw crossroads in the style of <a href="#crossinglines">Figure  4</a>, how would
you then indicate which of these are bridges or tunnels (brunels)
rather than crossroads? By using some different connectivity rules:</p>
<blockquote>
<div><p><strong>Alternative connectivity rules</strong></p>
<ul class="simple">
<li><em>Link-Unlink (polygon) rule</em>.  Intersecting links are assumed to join unless they are specifically marked otherwise.  This is done with a separate layer of unlinks (drawn as polygons).  This is an easy format to draw by hand.</li>
<li><em>Link-Unlink (data) rule</em>.   Intersecting links are assumed to join unless they are specifically marked otherwise.  This is done by having a brunel data field attached to each line.  This is an easy format to draw by hand.</li>
<li><em>Link-Endpoint Grade Separation rule</em>.  Intersections are not allowed in the data at all; ALL lines where they touch MUST have coincident endpoints.  Where links don’t join at their endpoints this is shown by providing elevation or grade separation data – two data fields attached to each line, one for the line start and the other for its end.  (OS ITN does this).</li>
<li><em>Link-Node rule</em>.  Intersections are not allowed in the data at all; ALL lines where they touch MUST have coincident endpoints.  Where links don’t join at their endpoints this is shown by providing elevation or grade separation data – endpoints are assumed not to join unless their elevation and grade separation match.  This data is provided in a separate layer of points, cross-referenced to the lines whose elevations they represent (OS Meridian does this).</li>
</ul>
<p>Note one advantage of the latter two formats is that intersecting lines are not allowed at all; therefore any detected by software are guaranteed to be data errors.  Catching errors in data is an important function we discuss later.</p>
</div></blockquote>
<p>The problem then remains to convert from these other formats to a network
with a coincident endpoint connectivity rule.</p>
<ul class="simple">
<li><strong>For link-unlink (polygon) rule</strong>, sDNA for Autocad includes a tool
to convert the network. If you need this tool for GIS, drop us a line
– nobody has asked for it yet but we can look at making it.
Alternatively, in any GIS system, convert the network to link-unlink
(data) format as follows:<ul>
<li>use the unlink polygon layer to split links at unlink polygon
boundaries</li>
<li>create a <em>brunel</em> data field on the link layer</li>
<li>select links within the polygons of the unlink layer, and mark
them as <em>brunels</em> in the data field</li>
<li>your network is now in link-unlink (data) format. Follow the steps
below to convert <strong>link-unlink (data)</strong> into coincident endpoint
format.</li>
</ul>
</li>
<li><strong>For link-unlink (data) rule</strong>, use a <a class="reference internal" href="#break-intersections">Break intersections</a>
tool to break all lines except for
brunels. Split the layer into two separate layers; one for brunels,
the other for the rest of the links. Break intersections on the link layer, then
rejoin the layers.</li>
<li><strong>For Link-Endpoint Grade separation rule</strong>, there is no need to
convert. All sDNA tools accept start- and end-grade separation data
attached to links; endpoints will be assumed to connect if and only
if their grade separations match.</li>
<li><strong>For Link-Node rule</strong>, get in touch with us – although they are not
released to the public yet, we have some tools to do this.</li>
</ul>
<p><strong>Summary:  ensure you understand spatial network
connectivity rules, and (for sDNA) that your network uses coincident endpoint
connectivity.</strong></p>
</div>
<div class="section" id="spatial-reference">
<span id="projection"></span><h4>Spatial reference<a class="headerlink" href="#spatial-reference" title="Permalink to this headline">¶</a></h4>
<p>Returning to <a href="#crossinglines">Figure  4</a> and <a href="#crossinglinesnoded">Figure  5</a>, even though we may know what the lines
represent – and their connectivity rule – we still don’t know what the
coordinates represent. This is the <em>spatial reference</em> of the data. The
issue is important both when creating new data, and when
downloading existing data from other sources.</p>
<p>Spatial references can either be Geographic or Projected. Geographic
coordinate systems specify a position on the surface of the earth, by
measuring angles of latitude and longitude from the earth’s axis. WGS84,
the dominant global standard for GPS and mapping data, is an example of
this.</p>
<p>While geographic coordinate systems describe a curved surface, projected
coordinate systems simplify the representation of small areas by making
the approximation that they are flat. Each country usually has a
national grid to use for this purpose, based on x and y coordinates.</p>
<p>To analyse a network, you probably want to use units of distance that
have some physical meaning to you – metres, miles or kilometres. If you
have downloaded data that uses a geographic coordinate system, this
usually means you will need to convert (project) it using your GIS or
CAD software.</p>
<p>Unfortunately, not everybody in the world understands spatial
references. This means that sometimes, data you receive may be marked
with the wrong spatial reference – watch out!</p>
<p>Another problem which can arise, is that the GIS software you use may
not correctly identify the transform needed to project the data you
downloaded onto a sensible grid. So, it is best to double check, and
manually select the correct transform if needed.</p>
<p>In the case of sDNA, if you are not sure whether your data is projected
properly, you can check what sDNA ‘sees’ as the length of links by
running the sDNA Individual Line Measures tool.  You can then check what sDNA reports for the
length of one or two different links. Is it what you expected? If not,
you probably have the wrong spatial reference and will need to reproject
your data.</p>
</div>
</div>
<div class="section" id="connectivity-errors-at-key-locations">
<span id="id5"></span><h3>Connectivity errors at key locations<a class="headerlink" href="#connectivity-errors-at-key-locations" title="Permalink to this headline">¶</a></h3>
<p>Even though you may have used the correct connectivity rule for your
network, it is possible that you or somebody else made a mistake when
drawing it. <a href="#faultycrossroads">Figure  6</a> shows the same network as figure 2, at four levels
of increasingly greater magnification:</p>
<div class="figure" id="id17">
<span id="faultycrossroads"></span><img alt="_images/prep3.PNG" src="_images/prep3.PNG" />
<p class="caption"><span class="caption-text">Figure 6: Zooming in on a faulty crossroads</span></p>
</div>
<p>Oh no! What looked like a perfectly normal crossroads from a distance,
turned out to be disconnected when we zoomed in. This is potentially a
very serious error. If you want an accurate model, this is of course
unacceptable – but even if you only want an approximate network model,
if such a disconnection is in a key location (such as a major through
route in a city) then the entire analysis could be meaningless, even for
a rough model.</p>
<p>The following sections deal with this, and other, forms of connectivity
error.</p>
<div class="section" id="cluster-tolerance">
<h4>Cluster tolerance<a class="headerlink" href="#cluster-tolerance" title="Permalink to this headline">¶</a></h4>
<p>We first introduce the idea of a <em>cluster tolerance</em>. This is a small
distance; on an urban scale perhaps 1cm (though larger cluster
tolerances can be useful sometimes). If two points are closer than the
cluster tolerance, then they are considered to be the same point. sDNA
supports two types of cluster tolerance, XYTolerance for horizontal
differences between points, and ZTolerance for vertical differences.</p>
<p>Note that some GIS systems, notably ArcGIS, will display unconnected
lines as connected – no matter how closely you zoom in – if the
disconnection is smaller than the cluster tolerance of the GIS! So, we
have to be very careful about whether lines are connected, because we
may not even be able to see errors, regardless of how closely we look.</p>
<p>The sDNA Prepare tool supports fixing of disconnections smaller than the
cluster tolerance. In the case of <a href="#faultycrossroads">Figure  6</a>, if you set a suitable
cluster tolerance then sDNA Prepare will connect the lines (provided the
network in <a href="#faultycrossroads">Figure  6</a> actually consists of four lines, rather than two –
see <a class="reference internal" href="#connectivity-rules"><span>Connectivity rules</span></a>). sDNA cluster tolerance applies only to the endpoints
of lines, not any points in between. In ArcGIS, sDNA uses whatever
tolerance ArcGIS is using by default, though a custom tolerance can also be
set.  On other platforms, the tolerance defaults to zero, i.e. no correction is performed.</p>
<p>But, let’s say you have downloaded some network data of unknown quality.
How can you tell what cluster tolerance to use? Too small, and you will
disconnect things that should be connected; too big, and you will
connect things that should be disconnected.</p>
<p>The answer is to use sDNA Prepare to detect (but not fix) cluster
tolerance errors.</p>
<blockquote>
<div><p><strong>Fixing a network with unknown cluster tolerance</strong></p>
<ol class="arabic">
<li><p class="first">Start with a small tolerance size</p>
</li>
<li><p class="first">Use sDNA prepare to detect tolerance problems (“Edge endpoints closer than cluster/XYTolerance”), and examine the errors it finds.</p>
</li>
<li><p class="first">Are the features detected all errors, or are some of them genuine small gaps that should not be connected?</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>If all the features detected are genuine, then the network is ready to use.</li>
<li>If some - but not all - of the features are genuine, choose a smaller tolerance, and go back to step 2.</li>
<li>If all of the features are errors, use sDNA prepare to fix them.  Then, choose a larger tolerance and go back to step 2.</li>
<li>If no features are detected at all, then choose a larger tolerance and go back to step 2. If you keep alternating between (b) and (d) above, then the errors and genuine features are the same size.  This means the network is of very poor quality and must be fixed by hand.</li>
</ol>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="intersections-and-overlaps">
<h4>Intersections and overlaps<a class="headerlink" href="#intersections-and-overlaps" title="Permalink to this headline">¶</a></h4>
<p>Another kind of connectivity error can arise when lines intersect or
overlap. Really this is a restatement of <a class="reference internal" href="#connectivity-rules"><span>Connectivity rules</span></a>, but here we focus on errors that can happen when encoding the
endpoint connectivity rule, rather than choosing the wrong rule
altogether.</p>
<div class="figure" id="id18">
<span id="faultyjunctions"></span><img alt="_images/prep4.PNG" src="_images/prep4.PNG" />
<p class="caption"><span class="caption-text">Figure 7: (a) a pair of junctions; (b) correct set of lines to represent
junctions (arrowheads included to show endpoints); (c) incorrect set of
lines to represent junctions - intersection error; (d) incorrect set of
lines to represent junctions – overlap error. The parallel lines in (d)
actually overlap, they are shown here slightly separated for clarity.</span></p>
</div>
<p><a href="#faultyjunctions">Figure  7</a> shows a set of two junctions (a), represented correctly (b) and
also incorrectly (c, d). Note how use of arrowheads at both ends of each
line allows you to see errors more clearly – when checking a network, it
is recommended practice to configure your GIS to do this <a class="footnote-reference" href="#id7" id="id6">[2]</a>.</p>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[2]</a></td><td>In ArcGIS the arrow settings are rather well hidden. Look at <em>layer
properties -&gt; symbology -&gt; symbol -&gt; edit symbol -&gt; set type to
“cartographic line symbol” -&gt; line properties</em>.</td></tr>
</tbody>
</table>
<p>These kinds of errors can be fixed using <a class="reference internal" href="#topology">Topology</a> tools.  If grade separation data is present, care must be taken that that breaking intersections does not move the grade separation data to the wrong
link: it is advisable to search for all nonzero grade separations and check them by hand after line breaking operations.</p>
<p>We recommend breaking links where bridges/tunnels exist, so
long as grade separation data is correctly attached to these. This has
the advantage that <em>all intersections become errors</em>: if you see an
intersection, you can be sure it is a mistake in the network rather than
a brunel, as the latter would be coded with grade separation data. A
similar policy can be applied to <em>loop links</em> which start and end at the
same point (such as a circular cul-de-sac). If these are deliberately
broken into two links rather than one, you can be certain that all loop
links are errors also. This prevents the drawing of e.g. a roundabout
that is not connected to anything.</p>
</div>
<div class="section" id="incorrect-grade-separation-elevation-and-oneway-data">
<h4>Incorrect grade separation, elevation and oneway data<a class="headerlink" href="#incorrect-grade-separation-elevation-and-oneway-data" title="Permalink to this headline">¶</a></h4>
<p>A third kind of connectivity error arises when grade separation,
elevation or one-way information is incorrect. In the former cases, even
overlapping endpoints will be wrongly assumed disconnected if the grade
separation or elevation data is wrong. In the latter case, a one-way street pointing
the wrong way can lead to an impossible situation.</p>
<p>The way to check this kind of information is to display it and have a
look. If you have grade separation data, it will take the form of two
data fields on each link – one for each end of the link (in sDNA, these
are usually called start_gs and end_gs). The start and end of a line
refer to the way it was drawn – note this is <em>not necessarily the same
direction as the flow of a one-way link.</em> So, for start and end grade
separation to be interpretable, the GIS should be set to display arrowheads only at the
end of lines, to make clear which end the start and end grade separation
refer to.</p>
<p>In ArcGIS, you can get custom labelling of link start and end grade
separation from the <em>Layer properties -&gt; label features</em> dialog. Turn on
labelling and in <em>Placement properties</em> choose <em>Place one label per
feature.</em> Click on <em>Expression</em> to create a label from multiple fields.
The following is an example of an expression that labels each link with
connectivity, start and end grade separations; putting the grade
separations in brackets for easier reading:</p>
<div class="highlight-text"><div class="highlight"><pre>[LConn] &amp; &quot; (&quot; &amp; [start\_gs] &amp; &quot;/&quot; &amp; [end\_gs] &amp; &quot;)&quot;
</pre></div>
</div>
<p>(For more information on computing and checking connectivity, see the
following section).</p>
<p>To display one-way data, it is best to show an arrow in the direction of
the one-way street. In ArcGIS this can be achieved using a ‘categories’
symbology to show a forwards, backwards or no arrow depending on one-way
information attached to the street.</p>
<p>sDNA allows for elevation (z) data to be provided separately to grade separation.  At first
glance this seems odd, as these both measure the same thing.  However, it is often the case that
precise grade separation data is available, but only imprecise elevation data.  In the case of a 3d network
formed by draping a 2d network over a terrain model, the elevation differences of bridges and tunnels will not
be captured, so grade separation is still needed to indicate these.</p>
<p>To display and check elevation data, it is best to view the network in 3d.</p>
</div>
<div class="section" id="definitive-check-for-connectivity-errors">
<h4>Definitive check for connectivity errors<a class="headerlink" href="#definitive-check-for-connectivity-errors" title="Permalink to this headline">¶</a></h4>
<p>The definitive way to check for connectivity errors is to
get sDNA to calculate the connectivity of each link and see if it
displays what you think the connectivity should be. Run sDNA Individual Line Measures to compute the connectivity of each link, and check it is as you expect.  Link connectivity (LConn) is <em>the number of ends of other links that the link is attached
to</em>.</p>
<p>Of course, checking connectivity by hand over an entire network may be
too costly an operation for you to undertake. sDNA cluster
tolerance, and external tools to <a class="reference internal" href="#break-intersections">Break intersections</a> and fix <a class="reference internal" href="#topology">Topology</a> can fix connectivity errors automatically.
Bridges and tunnels are usually few in number, so can be checked manually. With a reliable source of data (such
as Ordnance Survey), we can usually trust that the source data is
correct in any case.</p>
<p>A final way to check for connectivity problems in key locations,
however, is to use sDNA to compute a simple model of angular betweenness. This
takes some computation time, but the results should highlight all major
routes through the network. If any of these look implausible – the
routes you expect to be major are not, or vice versa – this may hint at
a connectivity error on a major route.</p>
</div>
</div>
<div class="section" id="geometry-errors-at-key-locations">
<span id="id8"></span><h3>Geometry errors at key locations<a class="headerlink" href="#geometry-errors-at-key-locations" title="Permalink to this headline">¶</a></h3>
<p>The final common error in spatial network analysis applies only to angular
analysis, i.e., any analysis in which changes of direction are
considered important. This includes any hybrid analysis that includes a component of
angularity, but not Euclidean or topological analysis.</p>
<div class="figure" id="id19">
<span id="geomerror"></span><img alt="_images/prep5.PNG" src="_images/prep5.PNG" />
<p class="caption"><span class="caption-text">Figure 8: Two kinds of geometry error. In the lower picture, the zigzag
link may overlap the other link precisely, so be invisible to manual
checking.</span></p>
</div>
<p>There are certain types of error in feature encoding that cause spurious
changes of direction on simulated paths through the feature. <a href="#geomerror">Figure  8</a>
gives two examples. In the first, what appears at one scale to be a
crossroads is slightly staggered – so a route travelling from left to
right has to negotiate two 90° turns when in reality, none are needed at
all. This kind of problem is common even with usually reliable data
sets, which may not have been designed with angular analysis in mind.</p>
<p>In the second example of <a href="#geomerror">Figure  8</a>, a link is shown to have a zigzag
feature almost obscured by an adjoining link. The zigzag may in fact
completely overlap the other link, in which case it would be invisible
to casual inspection (though overlaps should be fixed as a matter of course when fixing <a class="reference internal" href="#connectivity-errors-at-key-locations"><span>Connectivity errors at key locations</span></a>).</p>
<p>One clue that almost always indicates a geometry error is a very short
line. To find these, sort all polylines in your model by length, and inspect the
shortest ones. Should they be there, or are they part of a staggered
crossroads?</p>
<p>As with overlap errors, <a class="reference internal" href="#topology">Topology</a> tools help to fix geometry errors.
All zigzags, staggered crossroads and short edges smaller than the
tolerance will be removed. It is up to the user to select a
suitable tolerance large enough to remove the errors you have observed
in the data, but small enough to leave genuine features intact.</p>
<div class="section" id="traffic-islands">
<h4>Traffic islands<a class="headerlink" href="#traffic-islands" title="Permalink to this headline">¶</a></h4>
<p>A final topic to cover is that of traffic islands in road networks. Some
data products (notably Ordnance Survey ITN) will encode larger traffic
islands by splitting a link into two parallel parts for the length of
the island ():num:<cite>Figure #trafficisland</cite>).</p>
<div class="figure" id="id20">
<span id="trafficisland"></span><img alt="_images/prep6.PNG" src="_images/prep6.PNG" />
<p class="caption"><span class="caption-text">Figure 9: Spatial network representation of traffic island. (a) road
layout, (b) network representation</span></p>
</div>
<p>This encoding breaks angular analysis, by introducing a spurious 180° of
turning in each direction along a road which is straight. The problem
can be significant, as traffic islands are typically found on major
routes through a city; the extra angularity introduced by traffic island encoding
will cause sDNA to overestimate the metric for these roads and hence underestimate traffic flows.</p>
<p>sDNA Prepare includes a tool to fix traffic islands. You first need to
compute a data field which is set to 1 for links which represent traffic
islands, and 0 otherwise (this is usually easy to do from your source
data). Then, run sDNA prepare to remove the islands.</p>
</div>
</div>
</div>
<div class="section" id="tools">
<span id="id9"></span><h2>2.2. Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h2>
<p>The above discussion on network preparation has so far referred to tools for doing so only in the abstract.  This section points to a few software packages that can achieve the desired aims.</p>
<p>Note that all of these tools can potentially corrupt grade separation data for bridges and tunnels.</p>
<p>Also note that fixing geometry problems using Topology tools will often fix connectivity problems at the same time.</p>
<div class="section" id="break-intersections">
<span id="id10"></span><h3>Break intersections<a class="headerlink" href="#break-intersections" title="Permalink to this headline">¶</a></h3>
<p>Breaking intersections between lines means converting intersections from the type shown in <a href="#crossinglines">Figure  4</a> to the type shown in <a href="#crossinglinesnoded">Figure  5</a>.</p>
<ul>
<li><dl class="first docutils">
<dt><strong>QGIS</strong>:</dt>
<dd><p class="first last">within the open source environment, using the <code class="docutils literal"><span class="pre">break</span></code> option on <a class="reference external" href="https://grass.osgeo.org/grass64/manuals/v.clean.html">v.clean in the GRASS tools</a> can be used to break polylines where they intersect.  The GRASS tools are bundled with the free <a class="reference external" href="http://www.qgis.org/en/site/">QGIS</a>, though to display them it is necessary to switch the Processing toolbox to advanced mode.  (This is necessary for <a class="reference internal" href="installation_usage.html#firstuse"><span>Using sDNA for the first time</span></a> in any case).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>ArcGIS</strong>:</dt>
<dd><p class="first last">ArcGIS Advanced offers two tools to break intersections <em>en masse</em>.  The simplest is to run <a class="reference external" href="http://resources.arcgis.com/en/help/main/10.1/index.html#//01m800000012000000">ArcGIS Planarize</a> with a tolerance of zero.  The alternative is to use <a class="reference external" href="http://resources.arcgis.com/en/help/main/10.1/index.html#//006200000001000000">Arc Topology</a> tools to detect and fix all intersections.  We have found the latter is more flexible, but less able to deal with large numbers of intersections.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>Autocad Map3d</strong>:</dt>
<dd><p class="first last">Autocad Map3d has a <em>Break lines at intersections</em> tool within the <a class="reference external" href="http://docs.autodesk.com/MAP/2010/ENU/AutoCAD%20Map%203D%202010%20User%20Documentation/HTML%20Help/index.html?url=WS577DED0A95F53B408A6BF9656CAD6D4E.htm,topicNumber=d0e71485">Drawing Cleanup</a> toolkit.</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="topology">
<span id="id11"></span><h3>Topology<a class="headerlink" href="#topology" title="Permalink to this headline">¶</a></h3>
<p>For the purpose of this document, we define Topology tools as those which can fix approximate (as well as actual) intersections and duplicates within a given cluster tolerance.
These are very useful for cleaning up geometry errors such as those shown in <a href="#faultyjunctions">Figure  7</a> and <a href="#geomerror">Figure  8</a>.  Note that sDNA <a class="reference internal" href="guide_to_individual_tools.html#prepare"><span>Prepare network</span></a> itself can fix intersections within a given tolerance <em>for link endpoints only</em>; for errors at other locations, use the following tools:</p>
<ul>
<li><dl class="first docutils">
<dt><strong>QGIS</strong>:</dt>
<dd><p class="first last">The <code class="docutils literal"><span class="pre">snap</span></code> option on <a class="reference external" href="https://grass.osgeo.org/grass64/manuals/v.clean.html">v.clean in the GRASS tools</a> will snap together portions of lines within a tolerance.  This should be followed by <code class="docutils literal"><span class="pre">break</span></code> and <code class="docutils literal"><span class="pre">rmline</span></code>.  The related tool <code class="docutils literal"><span class="pre">v.clean.advanced</span></code> will allow these operations to be combined.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>ArcGIS</strong>:</dt>
<dd><p class="first last">Use <a class="reference external" href="http://resources.arcgis.com/en/help/main/10.1/index.html#//01m800000012000000">ArcGIS Planarize</a> or <a class="reference external" href="http://resources.arcgis.com/en/help/main/10.1/index.html#//006200000001000000">Arc Topology</a>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>Autocad Map3d</strong>:</dt>
<dd><p class="first last">use <em>Apparent Intersections</em> in the <a class="reference external" href="http://docs.autodesk.com/MAP/2010/ENU/AutoCAD%20Map%203D%202010%20User%20Documentation/HTML%20Help/index.html?url=WS577DED0A95F53B408A6BF9656CAD6D4E.htm,topicNumber=d0e71485">Drawing Cleanup</a> toolkit.</p>
</dd>
</dl>
</li>
</ul>
<p>In all the above cases, take care to select a suitable tolerance or threshold value; large enough to fix errors but to leave genuine features intact.</p>
</div>
</div>
<div class="section" id="notes-on-specific-formats">
<span id="id12"></span><h2>2.3. Notes on specific formats<a class="headerlink" href="#notes-on-specific-formats" title="Permalink to this headline">¶</a></h2>
<div class="section" id="address-point-data">
<h3>Address point data<a class="headerlink" href="#address-point-data" title="Permalink to this headline">¶</a></h3>
<p>To process address point data (e.g. floor area or population attached to building entrances), join the data of interest to the network using the Spatial Join function of your GIS. If greater than link level accuracy is required, split links into shorter segments.</p>
</div>
<div class="section" id="openstreetmap-osm">
<span id="osm"></span><h3>OpenStreetMap (OSM)<a class="headerlink" href="#openstreetmap-osm" title="Permalink to this headline">¶</a></h3>
<p>Open Street Map (OSM) is currently the world’s most prominent open
mapping platform. A non-profit foundation registered in England and
Wales since 2006, OSM passed the million-user mark in 2013, containing
21 million miles of road data and recruiting 1000 new contributors per
day, resulting in ever increasing accuracy <a class="reference internal" href="#osm1" id="id13">[OSM1]</a>. More than 100
universities have research associated with Open Street Map <a class="reference internal" href="#osm2" id="id14">[OSM2]</a>.</p>
<p>On the other hand, the crowd-sourced nature of OSM means that some
unique problems are encountered in its usage. Data quality is not
consistent, with more accuracy in some regions than others; there is
also a lack of consistency between regions when it comes to the
recording of link attributes. The definitive OSM source data is
corrected and updated daily, although with a bias towards more updates
in some areas than others.</p>
<p>These issues notwithstanding, we expect OSM to improve over time, and we
have already found it to be very useful here at sDNA headquarters. In 2014 the author produced a model of the Cardiff city region based on
OSM, that correctly predicted 90% of the variance in vehicle traffic
flows, and 75% of the variance in flows of pedal cycles. In the UK, OSM
is probably the most complete digital record of pedestrian and pedal
cycle routes published to date.</p>
<p>Our experience with OSM has alerted us to the following pitfalls:</p>
<ol class="arabic">
<li><p class="first">Spatial referencing in ArcGIS</p>
<blockquote>
<div><p>OpenStreetMap is stored and downloaded on the WGS84 datum. ArcGIS fails
to correctly identify the transformation necessary to project OSM data
to a national grid. The easiest way to resolve this is (before loading
the data) to mark it as WGS84 using ArcCatalog.  Once loaded, the data must be reprojected to a Euclidean (projected)
coordinate system before analysing in sDNA.</p>
<p>The free QGIS handles OSM data correctly, though it must still be reprojected before use with sDNA.</p>
</div></blockquote>
</li>
<li><p class="first">Connectivity and geometry errors</p>
<blockquote>
<div><p>As of November 2014, the OSM data for Cardiff contained a number of
connectivity and geometry errors. These were fixed by planarizing in ArcGIS with a
1m cluster tolerance. It was first necessary to extract bridges and
tunnels, to avoid planarizing these also.</p>
</div></blockquote>
</li>
</ol>
<p>See also the step by step guide, <a class="reference internal" href="step_by_step_guides.html#osm-step-by-step"><span>Downloading and preparing data from OpenStreetMap</span></a>.</p>
<p>OSM, despite its inconsistencies, is a very useful spatial model as of
November 2014, and we expect it only to improve for the foreseeable
future.</p>
<table class="docutils citation" frame="void" id="osm1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13">[OSM1]</a></td><td>See <a class="reference external" href="https://www.mapbox.com/osm-data-report/">https://www.mapbox.com/osm-data-report/</a> and <a class="reference external" href="http://radar.oreilly.com/2014/08/ten-years-of-openstreetmap.html">http://radar.oreilly.com/2014/08/ten-years-of-openstreetmap.html</a></td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="osm2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id14">[OSM2]</a></td><td><a class="reference external" href="http://wiki.openstreetmap.org/wiki/Research">http://wiki.openstreetmap.org/wiki/Research</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="pedestrian-networks">
<h3>Pedestrian networks<a class="headerlink" href="#pedestrian-networks" title="Permalink to this headline">¶</a></h3>
<p>We have in the past produced a <a class="reference external" href="http://www.cf.ac.uk/sdna/wp-content/downloads/documentation/sDNA%20Pedestrian%20Network%20Recommended%20Spec%20v2.pdf">specification</a> that deals with how to reliably create pedestrian networks for complex urban environments (joining interior and exterior networks in 3d).</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="analysis-friendly.html" title="3. Analysis: what the results mean"
             >next</a></li>
        <li class="right" >
          <a href="introduction.html" title="1. Introduction"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">sDNA Open 4.0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
  </body>
</html>